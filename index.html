<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Video Upload - Suggested Videos</title>

    <!-- Wistia Player Script -->
    <script src="https://fast.wistia.com/assets/external/E-v1.js" async></script>

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .wistia_embed {
            width: 100%;
            height: 360px;
        }

        /* Glow effect for live video */
        .wistia_embed.live-video {
            box-shadow: 0 0 15px 5px rgba(255, 0, 0, 0.8);
            border: 2px solid red;
            background-color: rgba(255, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-100">

<div class="max-w-7xl mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row lg:items-start gap-6">
        <!-- Video Player Section -->
        <div class="flex-1 bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h2 id="videoTitle" class="text-2xl font-bold text-gray-800">
                        Course Video: Introduction to Art
                    </h2>
                    <p class="text-sm text-gray-500 mt-1">Course > Module 1 > Introduction</p>
                </div>
                <div>
                    <span class="text-sm font-medium text-gray-600">Progress: </span>
                    <span id="currentPercentage" class="text-green-500 font-semibold">0%</span>
                </div>
            </div>

            <!-- Main Video Player -->
            <div id="wistiaPlayer" class="wistia_embed"></div>

            <div class="flex justify-between items-center mt-4">
                <div class="flex space-x-4">
                    <button id="previousTutorial" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <button id="nextTutorial" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Suggested Videos Section -->
        <div class="w-full lg:w-1/3 bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Suggested Videos</h3>
            <ul id="suggestedVideos" class="space-y-4"></ul>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const API_KEY = '00050b2cb9cd69ab2c879dc0442eaaa447088fbbed66585ac837478df5e0cc92';
        const videoContainer = document.getElementById('wistiaPlayer');
        const suggestedVideosList = document.getElementById('suggestedVideos');
        const videoTitle = document.getElementById('videoTitle');
        const previousButton = document.getElementById('previousTutorial');
        const nextButton = document.getElementById('nextTutorial');

        let videos = [];
        let currentVideoIndex = 0;

        // Fetch videos from Wistia API
        async function fetchVideos() {
            try {
                const response = await fetch('https://api.wistia.com/v1/medias.json', {
                    headers: { 'Authorization': `Bearer ${API_KEY}` }
                });
                if (!response.ok) throw new Error('Failed to fetch videos.');

                videos = await response.json();
                if (videos.length > 0) {
                    displayMainVideo(videos[0]);
                    displaySuggestedVideos(videos);
                } else {
                    videoTitle.textContent = 'No videos available.';
                }
            } catch (error) {
                console.error('Error fetching videos:', error);
                videoTitle.textContent = 'Error loading videos.';
            }
        }

        // Display the main video in the player
        function displayMainVideo(video) {
            videoContainer.innerHTML = `<div class="wistia_embed wistia_async_${video.hashed_id}"></div>`;
            videoTitle.textContent = video.name;

            // Check if the video is live
            if (video.state === 'live') {
                videoContainer.classList.add('live-video');  // Apply the glowing effect
                alert("This is a live video event!");
            } else {
                videoContainer.classList.remove('live-video');  // Remove glow for non-live videos
            }

            window._wq = window._wq || [];
            _wq.push({
                id: video.hashed_id,
                onReady: (player) => {
                    player.bind('timechange', () => {
                        const progress = ((player.time() / player.duration()) * 100).toFixed(0);
                        document.getElementById('currentPercentage').textContent = `${progress}%`;
                    });
                }
            });
        }

        // Display suggested videos list
        function displaySuggestedVideos(videos) {
            suggestedVideosList.innerHTML = '';
            videos.forEach((video, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'flex gap-4 p-3 rounded-lg hover:bg-gray-100 transition';
                listItem.innerHTML = `
                    <img src="${video.thumbnail.url}" alt="Thumbnail" class="w-32 h-20 object-cover rounded-md">
                    <div>
                        <h4 class="text-sm font-semibold text-gray-800">${video.name}</h4>
                        <p class="text-xs text-gray-500">${video.description || 'No description available'}</p>
                    </div>
                `;
                listItem.addEventListener('click', () => {
                    currentVideoIndex = index;
                    displayMainVideo(video);
                });
                suggestedVideosList.appendChild(listItem);
            });
        }

        // Navigate to the previous video
        previousButton.addEventListener('click', () => {
            if (currentVideoIndex > 0) {
                currentVideoIndex--;
                displayMainVideo(videos[currentVideoIndex]);
            }
        });

        // Navigate to the next video
        nextButton.addEventListener('click', () => {
            if (currentVideoIndex < videos.length - 1) {
                currentVideoIndex++;
                displayMainVideo(videos[currentVideoIndex]);
            }
        });

        fetchVideos();
    });
</script>

</body>
</html>
